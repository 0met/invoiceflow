import React, { useState, useEffect } from 'react';

// Main App component for the entire application
const App = () => {
  // State for all the application data and UI settings
  const [view, setView] = useState('dashboard'); // 'dashboard' or 'create'
  const [invoices, setInvoices] = useState([]);
  const [clients, setClients] = useState([]);
  const [items, setItems] = useState([]);
  const [currentInvoice, setCurrentInvoice] = useState(null); // The invoice being edited
  const [darkMode, setDarkMode] = useState(false);
  
  // State for the current invoice form inputs
  const [companyName, setCompanyName] = useState('');
  const [clientName, setClientName] = useState('');
  const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0]);
  const [invoiceNumber, setInvoiceNumber] = useState('');
  const [status, setStatus] = useState('Pending');
  const [lineItems, setLineItems] = useState([{ description: '', quantity: 1, rate: 0 }]);

  // Load data from localStorage on initial component mount
  useEffect(() => {
    const savedData = JSON.parse(localStorage.getItem('invoiceFlowData')) || {
      invoices: [],
      clients: [],
      items: [],
    };
    setInvoices(savedData.invoices);
    setClients(savedData.clients);
    setItems(savedData.items);
  }, []);

  // Save data to localStorage whenever invoices, clients, or items change
  useEffect(() => {
    localStorage.setItem('invoiceFlowData', JSON.stringify({ invoices, clients, items }));
  }, [invoices, clients, items]);

  // Function to save a new or updated invoice
  const saveInvoice = () => {
    const newInvoice = {
      id: currentInvoice ? currentInvoice.id : Date.now(),
      companyName,
      clientName,
      invoiceDate,
      invoiceNumber,
      status,
      lineItems,
    };

    if (currentInvoice) {
      // Update existing invoice
      setInvoices(invoices.map(inv => inv.id === newInvoice.id ? newInvoice : inv));
    } else {
      // Add new invoice
      setInvoices([...invoices, newInvoice]);
    }

    // Reset form and return to dashboard
    resetForm();
    setView('dashboard');
  };

  // Function to load an invoice for editing
  const loadInvoiceForEdit = (invoice) => {
    setCurrentInvoice(invoice);
    setCompanyName(invoice.companyName);
    setClientName(invoice.clientName);
    setInvoiceDate(invoice.invoiceDate);
    setInvoiceNumber(invoice.invoiceNumber);
    setStatus(invoice.status);
    setLineItems(invoice.lineItems);
    setView('create');
  };

  // Function to delete an invoice
  const deleteInvoice = (id) => {
    setInvoices(invoices.filter(inv => inv.id !== id));
  };
  
  // Function to delete a saved client
  const deleteClient = (clientName) => {
    setClients(clients.filter(c => c !== clientName));
  };

  // Function to delete a saved item
  const deleteItem = (itemDescription) => {
    setItems(items.filter(i => i.description !== itemDescription));
  };

  // Function to reset the invoice form
  const resetForm = () => {
    setCurrentInvoice(null);
    setCompanyName('');
    setClientName('');
    setInvoiceDate(new Date().toISOString().split('T')[0]);
    setInvoiceNumber('');
    setStatus('Pending');
    setLineItems([{ description: '', quantity: 1, rate: 0 }]);
  };
  
  // Function to save a client to the library
  const saveClient = () => {
    if (clientName && !clients.includes(clientName)) {
      setClients([...clients, clientName]);
    }
  };
  
  // Function to save an item to the library
  const saveItem = () => {
    const lastItem = lineItems[lineItems.length - 1];
    if (lastItem.description && !items.some(item => item.description === lastItem.description)) {
      setItems([...items, lastItem]);
    }
  };

  // Toggles dark mode
  const toggleDarkMode = () => {
    setDarkMode(!darkMode);
  };

  // --- Components for different views ---

  // Dashboard View
  const Dashboard = () => {
    const totalInvoices = invoices.length;
    const totalRevenue = invoices.reduce((sum, inv) => 
      sum + inv.lineItems.reduce((lineSum, item) => lineSum + item.quantity * item.rate, 0),
      0
    );
    const paidInvoices = invoices.filter(inv => inv.status === 'Paid').length;

    return (
      <div className="flex flex-col gap-8 w-full p-6">
        <h2 className="text-3xl font-bold text-gray-800 dark:text-gray-100">Invoice Dashboard</h2>
        
        {/* Summary Metrics */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div className="bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center">
            <p className="text-lg font-medium text-gray-500 dark:text-gray-400">Total Invoices</p>
            <p className="text-4xl font-extrabold text-indigo-600 dark:text-indigo-400 mt-2">{totalInvoices}</p>
          </div>
          <div className="bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center">
            <p className="text-lg font-medium text-gray-500 dark:text-gray-400">Total Revenue</p>
            <p className="text-4xl font-extrabold text-green-600 dark:text-green-400 mt-2">${totalRevenue.toFixed(2)}</p>
          </div>
          <div className="bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center">
            <p className="text-lg font-medium text-gray-500 dark:text-gray-400">Paid Invoices</p>
            <p className="text-4xl font-extrabold text-blue-600 dark:text-blue-400 mt-2">{paidInvoices}</p>
          </div>
        </div>

        {/* Invoices Table */}
        <div className="bg-white dark:bg-gray-700 p-6 rounded-xl shadow-lg">
          <h3 className="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100">All Invoices</h3>
          <div className="overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
              <thead className="bg-gray-50 dark:bg-gray-800">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Invoice #</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Client</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Amount</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="bg-white dark:bg-gray-700 divide-y divide-gray-200 dark:divide-gray-600">
                {invoices.map(invoice => (
                  <tr key={invoice.id} className="hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">{invoice.invoiceNumber}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">{invoice.clientName}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">{invoice.invoiceDate}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm">
                      <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${invoice.status === 'Paid' ? 'bg-green-100 text-green-800 dark:bg-green-700 dark:text-green-100' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-700 dark:text-yellow-100'}`}>
                        {invoice.status}
                      </span>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                      ${invoice.lineItems.reduce((sum, item) => sum + item.quantity * item.rate, 0).toFixed(2)}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <button onClick={() => loadInvoiceForEdit(invoice)} className="text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-200 transition-colors">Edit</button>
                      <button onClick={() => deleteInvoice(invoice.id)} className="text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-200 ml-4 transition-colors">Delete</button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  };
  
  // Form View for creating/editing invoices
  const InvoiceForm = () => {
    // PDF Export function using html2canvas and jsPDF
    const downloadPDF = () => {
      const { jsPDF } = window.jspdf;
      const previewElement = document.getElementById('invoice-preview');

      html2canvas(previewElement, { 
        scale: 2
      }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'mm', 'a4');
        const imgWidth = 210; 
        const pageHeight = 295;
        const imgHeight = canvas.height * imgWidth / canvas.width;
        let heightLeft = imgHeight;
        let position = 0;
        
        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
        
        while (heightLeft >= 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }
        
        pdf.save(`invoice_${invoiceNumber || 'new'}.pdf`);
      });
    };
    
    // Calculates total amount for the current invoice
    const totalAmount = lineItems.reduce((sum, item) => sum + (item.quantity * item.rate), 0);

    // Renders the live invoice preview
    const renderPreview = () => {
        let previewHTML = `
            <div class="p-8 bg-white dark:bg-gray-800 rounded-xl shadow-md">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h3 class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">${companyName || 'Your Company'}</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Invoice for: <strong class="text-gray-800 dark:text-gray-200">${clientName || 'Client Name'}</strong></p>
                    </div>
                    <div class="text-right">
                        <p class="text-gray-500 dark:text-gray-400">Invoice #: <strong class="text-gray-800 dark:text-gray-200">${invoiceNumber || 'INV-001'}</strong></p>
                        <p class="text-gray-500 dark:text-gray-400">Date: ${invoiceDate}</p>
                        <p class="text-gray-500 dark:text-gray-400 mt-2">Status: <strong class="font-bold ${status === 'Paid' ? 'text-green-600' : 'text-yellow-600'}">${status}</strong></p>
                    </div>
                </div>
                <div class="border-t border-gray-200 dark:border-gray-600 pt-6">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-500 dark:text-gray-400 uppercase text-sm">
                                <th class="w-1/2 font-semibold pb-2">Description</th>
                                <th class="w-1/6 font-semibold pb-2">Qty</th>
                                <th class="w-1/6 font-semibold pb-2">Rate</th>
                                <th class="w-1/6 text-right font-semibold pb-2">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${lineItems.map(item => `
                                <tr class="border-b border-gray-200 dark:border-gray-600 last:border-b-0">
                                    <td class="py-2 text-gray-800 dark:text-gray-200">${item.description}</td>
                                    <td class="py-2 text-gray-800 dark:text-gray-200">${item.quantity}</td>
                                    <td class="py-2 text-gray-800 dark:text-gray-200">$${item.rate.toFixed(2)}</td>
                                    <td class="py-2 text-right text-gray-800 dark:text-gray-200">$${(item.quantity * item.rate).toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div class="text-right mt-6">
                    <p class="text-lg font-bold text-gray-800 dark:text-gray-200">Total: <span class="text-indigo-600 dark:text-indigo-400">$${totalAmount.toFixed(2)}</span></p>
                </div>
            </div>
        `;
        document.getElementById('invoice-preview').innerHTML = previewHTML;
    };
    
    // Renders the preview every time state changes
    useEffect(renderPreview, [companyName, clientName, invoiceDate, invoiceNumber, status, lineItems]);

    return (
      <div className="grid grid-cols-1 md:grid-cols-2 gap-8 p-6">
        {/* Form Section */}
        <section className="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg">
          <h2 className="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100">Create New Invoice</h2>
          
          <div className="grid grid-cols-1 gap-4">
            <div>
              <label htmlFor="company-name" className="block text-sm font-medium text-gray-700 dark:text-gray-300">Your Company Name</label>
              <input type="text" id="company-name" value={companyName} onChange={(e) => setCompanyName(e.target.value)} placeholder="InvoiceFlow Inc." className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" />
            </div>

            <div>
              <label htmlFor="client-name" className="block text-sm font-medium text-gray-700 dark:text-gray-300">Client Name</label>
              <input type="text" id="client-name" list="clients-list" value={clientName} onChange={(e) => setClientName(e.target.value)} placeholder="John Doe" className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" />
              <datalist id="clients-list">
                {clients.map(client => <option key={client} value={client} />)}
              </datalist>
              <button onClick={saveClient} className="mt-2 text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200 font-medium">Save Client</button>
            </div>

            <div>
              <label htmlFor="invoice-date" className="block text-sm font-medium text-gray-700 dark:text-gray-300">Invoice Date</label>
              <input type="date" id="invoice-date" value={invoiceDate} onChange={(e) => setInvoiceDate(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" />
            </div>

            <div>
              <label htmlFor="invoice-number" className="block text-sm font-medium text-gray-700 dark:text-gray-300">Invoice Number</label>
              <input type="text" id="invoice-number" value={invoiceNumber} onChange={(e) => setInvoiceNumber(e.target.value)} placeholder="INV-001" className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" />
            </div>
            
            <div>
              <label htmlFor="status" className="block text-sm font-medium text-gray-700 dark:text-gray-300">Status</label>
              <select id="status" value={status} onChange={(e) => setStatus(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100">
                <option value="Pending">Pending</option>
                <option value="Paid">Paid</option>
              </select>
            </div>
          </div>

          <h3 className="text-xl font-bold mt-8 mb-4 text-gray-800 dark:text-gray-100">Invoice Items</h3>
          <div className="overflow-x-auto">
            <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
              <thead className="bg-gray-50 dark:bg-gray-800">
                <tr>
                  <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/2">Description</th>
                  <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6">Qty</th>
                  <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6">Rate</th>
                  <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/6">Amount</th>
                  <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider w-1/12"></th>
                </tr>
              </thead>
              <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600">
                {lineItems.map((item, index) => (
                  <tr key={index}>
                    <td className="py-2">
                      <input 
                        type="text" 
                        value={item.description} 
                        onChange={(e) => {
                          const newItems = [...lineItems];
                          newItems[index].description = e.target.value;
                          const savedItem = items.find(i => i.description === e.target.value);
                          if (savedItem) {
                            newItems[index].quantity = savedItem.quantity;
                            newItems[index].rate = savedItem.rate;
                          }
                          setLineItems(newItems);
                        }} 
                        placeholder="Description" 
                        list={`items-list-${index}`}
                        className="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" 
                      />
                      <datalist id={`items-list-${index}`}>
                        {items.map(savedItem => <option key={savedItem.description} value={savedItem.description} />)}
                      </datalist>
                    </td>
                    <td className="py-2"><input type="number" value={item.quantity} onChange={(e) => {
                      const newItems = [...lineItems];
                      newItems[index].quantity = parseFloat(e.target.value) || 0;
                      setLineItems(newItems);
                    }} className="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" /></td>
                    <td className="py-2"><input type="number" value={item.rate} onChange={(e) => {
                      const newItems = [...lineItems];
                      newItems[index].rate = parseFloat(e.target.value) || 0;
                      setLineItems(newItems);
                    }} className="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" /></td>
                    <td className="py-2 text-right text-gray-800 dark:text-gray-100">${(item.quantity * item.rate).toFixed(2)}</td>
                    <td className="py-2">
                      <button onClick={() => setLineItems(lineItems.filter((_, i) => i !== index))} className="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200">
                        <svg className="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          
          <div className="flex justify-between items-center mt-4">
            <button onClick={() => setLineItems([...lineItems, { description: '', quantity: 1, rate: 0 }])} className="px-4 py-2 border border-dashed border-indigo-600 text-indigo-600 dark:text-indigo-400 dark:border-indigo-400 rounded-md hover:bg-indigo-50 dark:hover:bg-gray-700">Add Item</button>
            <button onClick={saveItem} className="text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200 font-medium">Save Item</button>
          </div>

          <div className="text-right text-2xl font-bold mt-8 border-t pt-4 border-gray-200 dark:border-gray-600">
            Total: <span className="text-indigo-600 dark:text-indigo-400">${totalAmount.toFixed(2)}</span>
          </div>

          <button onClick={saveInvoice} className="w-full mt-6 py-3 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition-colors">
            {currentInvoice ? 'Update Invoice' : 'Save Invoice'}
          </button>
          <button onClick={downloadPDF} className="w-full mt-4 py-3 bg-gray-500 text-white rounded-lg shadow-md hover:bg-gray-600 transition-colors">
            Download PDF
          </button>
          {currentInvoice && (
            <button onClick={resetForm} className="w-full mt-4 py-3 bg-red-500 text-white rounded-lg shadow-md hover:bg-red-600 transition-colors">
              Cancel Edit
            </button>
          )}

          <div className="mt-8 pt-4 border-t border-gray-200 dark:border-gray-600">
            <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">Manage Saved Clients</h3>
            <ul className="space-y-2">
              {clients.map(client => (
                <li key={client} className="flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
                  <span className="text-gray-800 dark:text-gray-200">{client}</span>
                  <button onClick={() => deleteClient(client)} className="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-600">
                    <svg className="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                  </button>
                </li>
              ))}
            </ul>
          </div>
          
          <div className="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
            <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2">Manage Saved Items</h3>
            <ul className="space-y-2">
              {items.map(item => (
                <li key={item.description} className="flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
                  <span className="text-gray-800 dark:text-gray-200">{item.description} (${item.rate.toFixed(2)})</span>
                  <button onClick={() => deleteItem(item.description)} className="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-600">
                    <svg className="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                  </button>
                </li>
              ))}
            </ul>
          </div>

        </section>

        {/* Live Preview Section */}
        <section className="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg">
          <h2 className="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100">Live Preview</h2>
          <div id="invoice-preview" className="bg-gray-100 dark:bg-gray-900 rounded-lg p-6 shadow-inner">
            {/* The preview is rendered here */}
          </div>
        </section>
      </div>
    );
  };
  
  // Main return statement for the App component
  return (
    <div className={`min-h-screen bg-gray-100 dark:bg-gray-900 font-inter transition-colors duration-300 ${darkMode ? 'dark' : ''}`}>
      <script src="https://cdn.tailwindcss.com"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
      
      <header className="flex items-center justify-between p-6 bg-white dark:bg-gray-800 shadow-md">
        <h1 className="text-3xl font-bold text-indigo-600 dark:text-indigo-400">InvoiceFlow</h1>
        <div className="flex space-x-4">
          <button onClick={() => setView(view === 'dashboard' ? 'create' : 'dashboard')} className="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow-md hover:bg-indigo-700 transition-colors">
            {view === 'dashboard' ? 'Create New Invoice' : 'Back to Dashboard'}
          </button>
          <button onClick={toggleDarkMode} className="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg shadow-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
            {darkMode ? '☀️ Light Mode' : '🌙 Dark Mode'}
          </button>
        </div>
      </header>

      {view === 'dashboard' ? <Dashboard /> : <InvoiceForm />}
    </div>
  );
};

export default App;

